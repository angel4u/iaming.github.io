<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Drafts on liming.pub</title>
    <link>https://liming.pub/draft/</link>
    <description>Recent content in Drafts on liming.pub</description>
    <generator>Hugo -- gohugo.io</generator>
    <language>zh-cn</language>
    
	<atom:link href="https://liming.pub/draft/index.xml" rel="self" type="application/rss+xml" />
    
    
    <item>
      <title></title>
      <link>https://liming.pub/draft/gitlab-ci/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://liming.pub/draft/gitlab-ci/</guid>
      <description>= Gitlab-CI配置
== 服务端 === 开启CI === 配置CI == 客户端 === 安装gitlab-runner
[source,bash] curl -L https://packages.gitlab.com/install/repositories/runner/gitlab-ci-multi-runner/script.rpm.sh | sudo bash
yum install gitlab-ci-multi-runner === 配置gitlab-runner
vi /etc/gitlab-runner/config.toml
[source] concurrent = 10 check_interval = 0
[[runners]] name = &amp;ldquo;name&amp;rdquo; url = &amp;ldquo;http://192.168.1.1/ci&amp;quot; token = &amp;ldquo;&amp;rdquo; executor = &amp;ldquo;shell&amp;rdquo;
[runners.cache] === 常见问题： . 访问偶尔出现Forbidden 原因：Gitlab使用rack_attack做了并发访问的限制。 解决方案：将Gitlab的IP设置为白名单即可。编辑配置文件：
vi /etc/gitlab/gitlab.rb 输入“/”,查找gitlab_rails[&amp;lsquo;rack_attack_git_basic_auth&amp;rsquo;]关键词，取消注释。 修改ip_whitelist白名单属性，加入Gitlab部署的IP地址。如下所示：
1 2 3 4 5 6 7  gitlab_rails[&amp;#39;rack_attack_git_basic_auth&amp;#39;] = { &amp;#39;enabled&amp;#39; =&amp;gt; true, &amp;#39;ip_whitelist&amp;#39; =&amp;gt; [&amp;#34;127.</description>
    </item>
    
    <item>
      <title></title>
      <link>https://liming.pub/draft/linux-monitor/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://liming.pub/draft/linux-monitor/</guid>
      <description>服务器监控有专业的程序，其实可以手工利用shell搭建一个轻量级的监控系统。
== 磁盘监控
[source,shell] #!/bin/bash partition_list=(df -h | awk &#39;NF&amp;gt;3&amp;amp;&amp;amp;NR&amp;gt;1{sub(/%/,&amp;quot;&amp;quot;,$(NF-1));print $NF,$(NF-1)}&#39;) critical=90 # 阀值
notification_email() { email_addr=&amp;ldquo;用户名@liming.pub&amp;rdquo; title=&amp;rdquo;[Warn]xx服务器磁盘空间报警&amp;rdquo; mail -s &amp;ldquo;$title&amp;rdquo; &amp;ldquo;${email_addr}&amp;rdquo; }
crit_info=&amp;ldquo;&amp;rdquo; for (( i=0;i&amp;lt;${#partition_list[@]};i+=2 )) do if [ &amp;ldquo;${partition_list[((i+1))]}&amp;rdquo; -lt &amp;ldquo;$critical&amp;rdquo; ];then echo &amp;ldquo;OK! ${partition_list[i]} used ${partition_list[((i+1))]}%&amp;rdquo; else if [ &amp;ldquo;${partition_list[((i+1))]}&amp;rdquo; -gt &amp;ldquo;$critical&amp;rdquo; ];then crit_info=$crit_info&amp;rdquo;Warning!!! ${partition_list[i]} used ${partition_list[((i+1))]}%\n&amp;rdquo; fi fi done if [ &amp;ldquo;$crit_info&amp;rdquo; != &amp;ldquo;&amp;rdquo; ];then echo &amp;ldquo;发送邮件报警：&amp;rdquo;$crit_info echo -e $crit_info | notification_email #</description>
    </item>
    
    <item>
      <title></title>
      <link>https://liming.pub/draft/openresty/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      
      <guid>https://liming.pub/draft/openresty/</guid>
      <description>== 安装
http://openresty.org/cn/linux-packages.html
参考文档： https://moonbingbing.gitbooks.io/openresty-best-practices/
https://github.com/auth0/nginx-jwt
== auth0 .已过时
[source,bash] curl -L https://github.com/auth0/nginx-jwt/releases/download/v1.0.1/nginx-jwt.tar.gz -o /usr/local/openresty/scripts/nginx-jwt.tar.gz
tar -xvf nginx-jwt.tar.gz -C /usr/local/openresty/scripts/ .nginx.conf
[source] server { location / { access_by_lua &amp;lsquo; local jwt = require(&amp;ldquo;nginx-jwt&amp;rdquo;) jwt.auth() &amp;lsquo;;
1 2  proxy_pass http://my-backend.com$uri; }   } .nginx.conf
[source] env JWT_SECRET=123; env JWT_SECRET_IS_BASE64_ENCODED=true; http { lua_package_path &amp;ldquo;/usr/local/openresty/scripts/;;&amp;rdquo;; &amp;hellip;
} == lua-resty-jwt
[source,bash] mkdir -p /usr/local/openresty/nginx/jwt-lua/ curl -L https://github.com/SkyLothar/lua-resty-jwt/releases/download/v0.1.11/lua-resty-jwt-0.1.11.tar.gz -o /usr/local/openresty/nginx/jwt-lua/lua-resty-jwt-0.1.11.tar.gz tar -xvf /usr/local/openresty/nginx/jwt-lua/lua-resty-jwt-0.</description>
    </item>
    
  </channel>
</rss>